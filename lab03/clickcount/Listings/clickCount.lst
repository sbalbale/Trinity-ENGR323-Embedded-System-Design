A51 MACRO ASSEMBLER  CLICKCOUNT                                                           03/26/2025 14:31:04 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\clickCount.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE clickCount.asm SET(SMALL) DEBUG PRINT(.\Listings\clickCount.lst) OBJECT
                      (.\Objects\clickCount.obj) EP

LOC  OBJ            LINE     SOURCE

0000                   1     ORG     0000h           
0000 2100              2                 AJMP    MAIN           
                       3     
0003                   4                 ORG     0003h          ; External Interrupt 0 vector
0003 2199              5                 AJMP    EXT0_ISR           
                       6     
000B                   7                 ORG     000Bh          ; Timer 0 vector
000B 2131              8                 AJMP    Timer0_ISR
                       9     
0100                  10                 ORG     0100h          
0100 758130           11     MAIN:       MOV     SP, #30h       
0103 758901           12                 MOV     TMOD, #01h     ; Timer 0, mode 1 (16-bit)
                      13     
                      14                 ; Initialize registers
0106 C2D3             15                 CLR     RS0            ; Select Bank 0
0108 C2D4             16                 CLR     RS1
010A 7800             17                 MOV     R0, #00h      ; 1/100 digit
010C 7900             18                 MOV     R1, #00h      ; 1/10 digit
010E 7A00             19                 MOV     R2, #00h      ; Ones digit
0110 7B00             20                 MOV     R3, #00h      ; Tens digit
0112 7C00             21                 MOV     R4, #00h      ; Display position
0114 7D00             22                 MOV     R5, #00h      ; 5ms counter for 1 second tracking
                      23                 
                      24                 ; Initialize click tracking
0116 752000           25                 MOV     20h, #00h     ; Click counter low byte
0119 752100           26                 MOV     21h, #00h     ; Click counter high byte
011C 752200           27                 MOV     22h, #00h     ; Seconds counter
                      28                 
                      29                 ; Timer 0 setup for 5ms
011F 758CEC           30                 MOV     TH0, #0ECh     
0122 758A78           31                 MOV     TL0, #078h
0125 D28C             32                 SETB    TR0           ; Start Timer 0
                      33                 
                      34                 ; Setup External Interrupt 0
0127 D288             35                 SETB    IT0           ; Falling edge triggered
0129 D2A8             36                 SETB    EX0           ; Enable INT0
                      37                 
                      38                 ; Enable interrupts
012B D2A9             39                 SETB    ET0           ; Enable Timer 0 interrupt
012D D2AF             40                 SETB    EA            ; Enable global interrupts
                      41     
012F 80FE             42     MainLoop:   SJMP    MainLoop      ; Everything handled by interrupts
                      43     
0131 C0E0             44     Timer0_ISR: PUSH    ACC            
0133 C0D0             45                 PUSH    PSW
                      46     
                      47                 ; Reload timer for next 5ms
0135 C28C             48                 CLR     TR0            
0137 758CEC           49                 MOV     TH0, #0ECh     
013A 758A8C           50                 MOV     TL0, #08Ch     
013D C28D             51                 CLR     TF0            
013F D28C             52                 SETB    TR0            
                      53     
                      54                 ; Increment 5ms counter
0141 0D               55                 INC     R5
0142 ED               56                 MOV     A, R5
0143 B4C82A           57                 CJNE    A, #0C8h, Display_Update  ; 200 * 5ms = 1 second
A51 MACRO ASSEMBLER  CLICKCOUNT                                                           03/26/2025 14:31:04 PAGE     2

0146 7D00             58                 MOV     R5, #00h     
                      59     
                      60                 ; Increment seconds counter
0148 0522             61                 INC     22h
014A E522             62                 MOV     A, 22h
014C B43C03           63                 CJNE    A, #3Ch, Calc_CPM  ; 60 seconds = 1 minute
014F 752200           64                 MOV     22h, #00h     ; Reset seconds
                      65     
                      66                 ; Calculate Clicks Per Minute (CPM)
0152 E520             67     Calc_CPM:   MOV     A, 20h        ; Low byte of click count
0154 75F03C           68                 MOV     B, #60        ; Divide by current seconds count
0157 84               69                 DIV     AB            ; Divide click count by seconds elapsed
0158 FA               70                 MOV     R2, A         ; Ones digit
0159 A9F0             71                 MOV     R1, B         ; Remainder (for tenths)
                      72     
                      73                 ; Convert remainder to tenths
015B E9               74                 MOV     A, R1
015C 75F00A           75                 MOV     B, #10
015F 84               76                 DIV     AB
0160 F8               77                 MOV     R0, A         ; Tenths digit
0161 A9F0             78                 MOV     R1, B         ; Hundredths digit
                      79                 
                      80                 ; Clear tens digit if clicks per minute is less than 100
0163 7B00             81                 MOV     R3, #00h
                      82                 
                      83                 ; If result is over 99, set to 99
0165 B40A08           84                 CJNE    A, #0Ah, Display_Update
0168 7A09             85                 MOV     R2, #09h
016A 7909             86                 MOV     R1, #09h
016C 7809             87                 MOV     R0, #09h
016E 7B09             88                 MOV     R3, #09h
                      89     
0170                  90     Display_Update:
                      91                 ; Display routine
0170 EC               92                 MOV     A, R4          
0171 B40003           93                 CJNE    A, #00h, Pos1
0174 EB               94                 MOV     A, R3         ; Tens digit
0175 8013             95                 SJMP    Output_Digit
                      96     
0177 B40105           97     Pos1:       CJNE    A, #01h, Pos2
017A EA               98                 MOV     A, R2         ; Ones digit
017B 4410             99                 ORL     A, #10h        
017D 800B            100                 SJMP    Output_Digit
                     101     
017F B40205          102     Pos2:       CJNE    A, #02h, Pos3
0182 E9              103                 MOV     A, R1         ; Tenths digit
0183 4420            104                 ORL     A, #20h        
0185 8003            105                 SJMP    Output_Digit
                     106     
0187 E8              107     Pos3:       MOV     A, R0         ; Hundredths digit
0188 4430            108                 ORL     A, #30h        
                     109     
018A                 110     Output_Digit:
018A F590            111                 MOV     P1, A          
                     112     
                     113                 ; Update display position
018C EC              114                 MOV     A, R4
018D 04              115                 INC     A              
018E B40402          116                 CJNE    A, #04h, Save_Pos
0191 7400            117                 MOV     A, #00h        
0193 FC              118     Save_Pos:   MOV     R4, A         
                     119     
0194 D0D0            120                 POP     PSW            
0196 D0E0            121                 POP     ACC
0198 32              122                 RETI
                     123     
A51 MACRO ASSEMBLER  CLICKCOUNT                                                           03/26/2025 14:31:04 PAGE     3

0199 C0E0            124     EXT0_ISR:   PUSH    ACC
019B C0D0            125                 PUSH    PSW
                     126                 
                     127                 ; Increment click counter
019D 0520            128                 INC     20h            ; Increment low byte
019F E520            129                 MOV     A, 20h
01A1 7002            130                 JNZ     EXT0_ISR_Exit  ; If no rollover, exit
01A3 0521            131                 INC     21h            ; Increment high byte if low byte rolled over
                     132     
01A5                 133     EXT0_ISR_Exit:
01A5 D0D0            134                 POP     PSW
01A7 D0E0            135                 POP     ACC
01A9 32              136                 RETI
                     137     
                     138                 END
A51 MACRO ASSEMBLER  CLICKCOUNT                                                           03/26/2025 14:31:04 PAGE     4

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

ACC. . . . . . . .  D ADDR   00E0H   A   
B. . . . . . . . .  D ADDR   00F0H   A   
CALC_CPM . . . . .  C ADDR   0152H   A   
DISPLAY_UPDATE . .  C ADDR   0170H   A   
EA . . . . . . . .  B ADDR   00A8H.7 A   
ET0. . . . . . . .  B ADDR   00A8H.1 A   
EX0. . . . . . . .  B ADDR   00A8H.0 A   
EXT0_ISR . . . . .  C ADDR   0199H   A   
EXT0_ISR_EXIT. . .  C ADDR   01A5H   A   
IT0. . . . . . . .  B ADDR   0088H.0 A   
MAIN . . . . . . .  C ADDR   0100H   A   
MAINLOOP . . . . .  C ADDR   012FH   A   
OUTPUT_DIGIT . . .  C ADDR   018AH   A   
P1 . . . . . . . .  D ADDR   0090H   A   
POS1 . . . . . . .  C ADDR   0177H   A   
POS2 . . . . . . .  C ADDR   017FH   A   
POS3 . . . . . . .  C ADDR   0187H   A   
PSW. . . . . . . .  D ADDR   00D0H   A   
RS0. . . . . . . .  B ADDR   00D0H.3 A   
RS1. . . . . . . .  B ADDR   00D0H.4 A   
SAVE_POS . . . . .  C ADDR   0193H   A   
SP . . . . . . . .  D ADDR   0081H   A   
TF0. . . . . . . .  B ADDR   0088H.5 A   
TH0. . . . . . . .  D ADDR   008CH   A   
TIMER0_ISR . . . .  C ADDR   0131H   A   
TL0. . . . . . . .  D ADDR   008AH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
