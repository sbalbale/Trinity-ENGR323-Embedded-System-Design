A51 MACRO ASSEMBLER  STOPWATCH                                                            02/12/2025 15:39:07 PAGE     1


MACRO ASSEMBLER A51 V8.01
OBJECT MODULE PLACED IN stopwatch.OBJ
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE stopwatch.asm SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

0000                   1     ORG 0000h
0000 2100              2         AJMP MainProg
                       3     
000B                   4     ORG 000Bh                  ; Timer 0 interrupt vector
000B 2123              5         AJMP Timer0_ISR
                       6     
0100                   7     ORG 0100h
0100                   8     MainProg:
0100 758130            9         MOV SP, #30h          ; Initialize stack pointer
0103 758901           10         MOV TMOD, #01h        ; Timer 0, mode 1 (16-bit)
                      11     
                      12         ; Initialize Timer 0 for 5ms interrupts (12MHz clock)
0106 758CEC           13         MOV TH0, #0ECh        ; Load timer high byte
0109 758A78           14         MOV TL0, #078h        ; Load timer low byte
                      15     
                      16         ; Initialize display digits in RAM
010C 752001           17         MOV 20h, #01h         ; First digit (1)
010F 752102           18         MOV 21h, #02h         ; Second digit (2)
0112 752203           19         MOV 22h, #03h         ; Third digit (3)
0115 752304           20         MOV 23h, #04h         ; Fourth digit (4)
0118 752400           21         MOV 24h, #00h         ; Current display position (0-3)
                      22     
                      23         ; Enable interrupts
011B D2A9             24         SETB ET0              ; Enable Timer 0 interrupt
011D D2AF             25         SETB EA               ; Enable global interrupts
011F D28C             26         SETB TR0              ; Start Timer 0
                      27     
0121                  28     MainLoop:
0121 80FE             29         SJMP MainLoop         ; Main program loop (empty)
                      30     
0123                  31     Timer0_ISR:
0123 C0E0             32         PUSH ACC              ; Save accumulator
0125 C0D0             33         PUSH PSW              ; Save program status word
                      34     
                      35         ; Reload timer for next 5ms interrupt
0127 C28C             36         CLR TR0               ; Stop timer
0129 758CEC           37         MOV TH0, #0ECh        ; Reload high byte
012C 758A77           38         MOV TL0, #077h        ; Reload low byte
012F C28D             39         CLR TF0               ; Clear overflow flag
0131 D28C             40         SETB TR0              ; Restart timer
                      41     
                      42         ; Get current display position
0133 E524             43         MOV A, 24h            ; Load current position
                      44     
                      45         ; Display digit based on position
0135 B40006           46         CJNE A, #00h, Try_Pos1
0138 E520             47         MOV A, 20h            ; Get digit 1
013A 540F             48         ANL A, #0Fh           ; Mask for BCD
013C 801C             49         SJMP Output_Digit
                      50     
013E                  51     Try_Pos1:
013E B40108           52         CJNE A, #01h, Try_Pos2
0141 E521             53         MOV A, 21h            ; Get digit 2
0143 540F             54         ANL A, #0Fh           ; Mask for BCD
0145 4410             55         ORL A, #010h          ; Set DMUX for position 1
0147 8011             56         SJMP Output_Digit
                      57     
0149                  58     Try_Pos2:
A51 MACRO ASSEMBLER  STOPWATCH                                                            02/12/2025 15:39:07 PAGE     2

0149 B40208           59         CJNE A, #02h, Try_Pos3
014C E522             60         MOV A, 22h            ; Get digit 3
014E 540F             61         ANL A, #0Fh           ; Mask for BCD
0150 4420             62         ORL A, #020h          ; Set DMUX for position 2
0152 8006             63         SJMP Output_Digit
                      64     
0154                  65     Try_Pos3:
0154 E523             66         MOV A, 23h            ; Get digit 4
0156 540F             67         ANL A, #0Fh           ; Mask for BCD
0158 4430             68         ORL A, #030h          ; Set DMUX for position 3
                      69     
015A                  70     Output_Digit:
015A F590             71         MOV P1, A             ; Output to display
                      72     
                      73         ; Update position counter
015C E524             74         MOV A, 24h
015E 04               75         INC A                 ; Increment position
015F B40402           76         CJNE A, #04h, Save_Pos
0162 7400             77         MOV A, #00h           ; Reset to 0 if reached 4
                      78     
0164                  79     Save_Pos:
0164 F524             80         MOV 24h, A            ; Save new position
                      81     
0166 D0D0             82         POP PSW               ; Restore program status word
0168 D0E0             83         POP ACC               ; Restore accumulator
016A 32               84         RETI
                      85     
                      86     END
A51 MACRO ASSEMBLER  STOPWATCH                                                            02/12/2025 15:39:07 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

ACC. . . . . . . .  D ADDR   00E0H   A   
EA . . . . . . . .  B ADDR   00A8H.7 A   
ET0. . . . . . . .  B ADDR   00A8H.1 A   
MAINLOOP . . . . .  C ADDR   0121H   A   
MAINPROG . . . . .  C ADDR   0100H   A   
OUTPUT_DIGIT . . .  C ADDR   015AH   A   
P1 . . . . . . . .  D ADDR   0090H   A   
PSW. . . . . . . .  D ADDR   00D0H   A   
SAVE_POS . . . . .  C ADDR   0164H   A   
SP . . . . . . . .  D ADDR   0081H   A   
TF0. . . . . . . .  B ADDR   0088H.5 A   
TH0. . . . . . . .  D ADDR   008CH   A   
TIMER0_ISR . . . .  C ADDR   0123H   A   
TL0. . . . . . . .  D ADDR   008AH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   
TRY_POS1 . . . . .  C ADDR   013EH   A   
TRY_POS2 . . . . .  C ADDR   0149H   A   
TRY_POS3 . . . . .  C ADDR   0154H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
